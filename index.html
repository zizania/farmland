<!DOCTYPE html>
<html>
<head>
  <script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body>
  <!-- <img src="./gmaps-sat.png"> -->
  <style>

.background {
  fill: none;
  pointer-events: all;
}

#map {
  display: block;
  margin: 0 auto;
}

#farmland-path {
  fill: #ccc;
  stroke: #aaa;
  stroke-width: 5px;
}

</style>
<body>
<script>

var farmland = {
  type: 'FeatureCollection',
  features: [{
    type: 'Feature',
    id: '01',
    properties: { name: 'Farmland' },
    geometry: {
      type: 'Polygon',
      coordinates: [
        [ [25.077871, 35.303472], [25.076187, 35.304391], [25.075897, 35.304890], [25.077935, 35.306011], [25.078139, 35.306178], [25.078043, 35.306335], [25.078965, 35.305915], [25.079008, 35.305696], [25.078601, 35.305950], [25.078450, 35.305906], [25.078472, 35.305617], [25.078386, 35.305486], [25.078322, 35.304645], [25.078214, 35.304251], [25.078118, 35.303542], [25.077871, 35.303472] ]
      ]
    }
  }]
}

var width  = window.innerWidth - 50
  , height = window.innerHeight - 50

var projection = d3.geo.mercator()
  .center([25.077496, 35.304934])
  .scale(50000000)

projection.translate([width / 2, height / 2])

var svg = d3.select('body').append('svg')
  .attr('id', 'map')
  .attr('width', width)
  .attr('height', height)
  .call(d3.behavior.zoom()
      .translate(projection.translate())
      .scale(projection.scale())
      .on("zoom", redraw))

var path = d3.geo.path().projection(projection)


var group = svg.append('g')
  .attr('id', 'farmland')


group.append('path')
  .attr('id', 'farmland-path')
  .datum(farmland)
  .attr('d', path)

var trees = [{
  id: 'a',
  coordinates: [25.075996, 35.304827]
}]

var treesGroup = group.append('g').attr('id', 'trees-group')

treesGroup
  .selectAll('circle').data(trees)
  .enter().append('circle')
  .attr('class', 'tree')
  .attr('id', function (c) { return c.id })
  .attr('r', 5)

redraw()

function redraw() {
  if (d3.event) {
    projection
        .translate(d3.event.translate)
        .scale(d3.event.scale)
  }

  // force re-projection
  group.selectAll('path').attr('d', path)

  var trees = group.selectAll('.tree')

  trees.call(function (circles) {
    circles
      .attr('cx', function (c) { return projection(c.coordinates)[0] })
      .attr('cy', function (c) { return projection(c.coordinates)[1] })
  })

  if (d3.event && d3.event.scale > 69737183) {
    treesGroup.selectAll()
  }
}


</script>
</body>
</html>
